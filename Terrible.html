<!DOCTYPE html>
<html>
<head>
<title>Terrible</title>
</head>

<body>
	
<script>

	var input = ["Tony Stark. Genius, billionaire, playboy, philanthropist. Son of legendary inventor and weapons contractor Howard Stark. When Tony Stark is assigned to give a weapons presentation to an Iraqi unit led by Lt. Col. James Rhodes, he's given a ride on enemy lines. That ride ends badly when Stark's Humvee that he's riding in is attacked by enemy combatants. He survives - barely - with a chest full of shrapnel and a car battery attached to his heart. In order to survive he comes up with a way to miniaturize the battery and figures out that the battery can power something else. Thus Iron Man is born. He uses the primitive device to escape from the cave in Iraq. Once back home, he then begins work on perfecting the Iron Man suit. But the man who was put in charge of Stark Industries has plans of his own to take over Tony's technology for other matters.", 
		
	"When Tony Stark tries to jumpstart a dormant peacekeeping program, things go awry and Earth's Mightiest Heroes, including Iron Man, Captain America, Thor, the Incredible Hulk, Black Widow and Hawkeye, are put to the ultimate test as the fate of the planet hangs in the balance. As the villainous Ultron emerges, it is up to the Avengers to stop him from enacting his terrible plans, and soon uneasy alliances and unexpected action pave the way for a global adventure."];

	function common(input1, input2) {
	
//Calculating the Keywords
		var output = encodeURIComponent(input1);
	
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "http://gateway-a.watsonplatform.net/calls/text/TextGetRankedKeywords?apikey=d79b2f182c0d4d69131506db921116ae3a044c74&text=" + output + "&outputMode=json", false);
		xhr.send(null);
		
		var text = JSON.parse(xhr.responseText);
		
		var keywords1 = text.keywords;
		
		for(var i = 0; i < keywords1.length; i++) {
			keywords1[i] = keywords1[i].text;
		}
		
		var counter = 0;
		
		while(counter < keywords1.length) {
			if(keywords1[counter].split(" ").length > 1) {
				var words = keywords1[counter].split(" ").length;
				var temp = keywords1[counter].split(" ");
				keywords1[counter] = temp[Math.floor(Math.random()*words)];
			}
			counter++;
		}
		
		keywords1.sort();
//end

//Second Keyword Calculation
		output = encodeURIComponent(input2);
	
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "http://gateway-a.watsonplatform.net/calls/text/TextGetRankedKeywords?apikey=d79b2f182c0d4d69131506db921116ae3a044c74&text=" + output + "&outputMode=json", false);
		xhr.send(null);

		var text2 = JSON.parse(xhr.responseText);
		
		var keywords2 = text2.keywords;
		
		for(var i = 0; i < keywords2.length; i++) {
			keywords2[i] = keywords2[i].text;
		}
		
		var counter = 0;
		
		while(counter < keywords2.length) {
			if(keywords2[counter].split(" ").length > 1) {
				var words = keywords2[counter].split(" ").length;
				var temp = keywords2[counter].split(" ");
				keywords2[counter] = temp[Math.floor(Math.random()*words)];
			}
			counter++;
		}
		
		keywords2.sort();
//end

		/*var arrays = [
		["primitive", "Tony", "Howard", "James", "Man", "Stark", "suit", "enemy", "car", "enemy", "legendary", "unit", "weapons", "primitive",  "ride",  "billionaire",  "shrapnel",  "philanthropist",  "playboy",  "Genius",  "chest",  "charge",  "Son",  "cave",  "Lt",  "way",  "heart",  "home",  "work"],
		["adventure",  "program",  " Mightiest",  "Incredible",  "Tony",  "Ultron",  "Black",  "Captain",  "plans",  "action",  "Man",  "test",  "adventure",  "Thor",  "Hawkeye",  "Avengers",  "fate",  "alliances",  "balance",  "things",  "Earth"]
		];*/
		
		var arrays = [
		keywords1, keywords2
		]
		

		var result = arrays.shift().reduce(function(res, v) {
			if (res.indexOf(v) === -1 && arrays.every(function(a) {
				return a.indexOf(v) !== -1;
			})) res.push(v);
			return res;
		}, []);
		
		return result;
	}
	
	console.log("outside " + common(input[0], input[1]));
	
	</script>
	

</body>

</html>